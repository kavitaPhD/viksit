<app-header></app-header>
<div id="main-wrapper" class="d-flex align-items-center justify-content-center min-vh-100 bg-light">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-7">
                <div class="card p-3 shadow-lg rounded-xl">
                    <div class="text-center mb-3">
                        <img src="assets/img/logo.png" alt="Logo" class="h-12 w-auto mb-2" 
                        style="height:100px ; width:auto;">
                    </div>
                    <form [formGroup]="loginForm" (ngSubmit)="login()">
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="username" formControlName="username"
                                placeholder="Enter User Name"
                                [ngClass]="{'is-invalid': loginForm.get('username')?.invalid && loginForm.get('username')?.touched}">
                            <label for="username">Enter User Name</label>
                            <mat-error
                                *ngIf="loginForm.controls['username']?.invalid && loginForm.controls['username']?.touched">
                                <span *ngIf="loginForm.controls['username'].errors!['required']">
                                    Username is required.
                                </span>
                            </mat-error>
                        </div>

                        <!-- Password Field -->
                        <div class="form-floating mb-4">
                            <input type="password" class="form-control" id="password" formControlName="password"
                                placeholder="Enter User Password" (change)="onPassChangeEvent($event)"
                                [ngClass]="{'is-invalid': loginForm.get('password')?.invalid && loginForm.get('password')?.touched}">
                            <label for="password">Enter User Password</label>
                            <mat-error
                                *ngIf="loginForm.controls['password']?.invalid && loginForm.controls['password']?.touched">
                                <!-- Fix applied: Using bracket notation and safe access -->
                                <span *ngIf="loginForm.controls['password'].errors!['required']">
                                    Password is required.
                                </span>
                            </mat-error>
                        </div>

                        <!-- Captcha Input and Display Group -->
                        <div class="d-flex flex-column mb-4">
                            <!-- 1. Captcha SVG and Refresh Button -->
                            <div
                                class="d-flex align-items-center justify-content-between mb-2 p-2 bg-light rounded-md border">
                                <div #dataContainer class="svg-img flex-grow-1 me-3">
                                    <!-- Captcha SVG will be rendered here -->
                                </div>
                                <button type="button" (click)="svgcaptcha()"
                                    class="btn btn-outline-secondary btn-sm rounded-circle p-2 shadow-sm"
                                    title="Refresh Captcha">
                                    <mat-icon>refresh</mat-icon>
                                </button>
                            </div>

                            <!-- 2. Captcha Input Field -->
                            <div class="form-floating mt-2">
                                <input type="text" class="form-control" id="captcha" formControlName="captcha"
                                    placeholder="Enter Captcha Here"
                                    [ngClass]="{'is-invalid': loginForm.get('captcha')?.invalid && loginForm.get('captcha')?.touched}">
                                <label for="captcha">Enter Captcha</label>
                            </div>
                        </div>

                        <!-- Error Messages -->
                        <div class="mb-3">
                            <div class="text-danger text-center" *ngIf="showInvalid">
                                <strong>{{errorText}}</strong>
                            </div>
                            <p class="text-danger text-center" *ngIf="showCaptchaError">
                                <strong>Please enter correct Captcha</strong>
                            </p>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <button type="submit" class="btn btn-info btn-lg shadow-sm" [disabled]="loginForm.invalid">
                                <mat-icon>login</mat-icon> Log In
                            </button>
                            <a [routerLink]="['/login']" (click)="refresh()" class="btn btn-warning btn-lg shadow-sm">
                                <mat-icon>autorenew</mat-icon> Refresh
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<app-footer></app-footer>